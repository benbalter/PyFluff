// Furby Connect Name Database
// All 129 possible Furby names

const FURBY_NAMES = [
    { id: 0, name: "Ah-Bay" },
    { id: 1, name: "Ah-Boh" },
    { id: 2, name: "Ah-Boo" },
    { id: 3, name: "Ah-Dah" },
    { id: 4, name: "Ah-Doh" },
    { id: 5, name: "Ah-Doo" },
    { id: 6, name: "Ah-Kah" },
    { id: 7, name: "Ah-Koh" },
    { id: 8, name: "Ah-Tah" },
    { id: 9, name: "Ah-Toh" },
    { id: 10, name: "Bee-Bay" },
    { id: 11, name: "Bee-Boh" },
    { id: 12, name: "Bee-Boo" },
    { id: 13, name: "Bee-Dah" },
    { id: 14, name: "Bee-Doh" },
    { id: 15, name: "Bee-Doo" },
    { id: 16, name: "Bee-Kah" },
    { id: 17, name: "Bee-Koh" },
    { id: 18, name: "Bee-Tah" },
    { id: 19, name: "Bee-Toh" },
    { id: 20, name: "Dah-Bay" },
    { id: 21, name: "Dah-Boh" },
    { id: 22, name: "Dah-Boo" },
    { id: 23, name: "Dah-Dah" },
    { id: 24, name: "Dah-Doh" },
    { id: 25, name: "Dah-Doo" },
    { id: 26, name: "Dah-Kah" },
    { id: 27, name: "Dah-Koh" },
    { id: 28, name: "Dah-Tah" },
    { id: 29, name: "Dah-Toh" },
    { id: 30, name: "Day-Bay" },
    { id: 31, name: "Day-Boh" },
    { id: 32, name: "Day-Boo" },
    { id: 33, name: "Day-Dah" },
    { id: 34, name: "Day-Doh" },
    { id: 35, name: "Day-Doo" },
    { id: 36, name: "Day-Kah" },
    { id: 37, name: "Day-Koh" },
    { id: 38, name: "Day-Tah" },
    { id: 39, name: "Day-Toh" },
    { id: 40, name: "Dee-Bay" },
    { id: 41, name: "Dee-Boh" },
    { id: 42, name: "Dee-Boo" },
    { id: 43, name: "Dee-Dah" },
    { id: 44, name: "Dee-Doh" },
    { id: 45, name: "Dee-Doo" },
    { id: 46, name: "Dee-Kah" },
    { id: 47, name: "Dee-Koh" },
    { id: 48, name: "Dee-Tah" },
    { id: 49, name: "Dee-Toh" },
    { id: 50, name: "Doo-Bay" },
    { id: 51, name: "Doo-Boh" },
    { id: 52, name: "Doo-Boo" },
    { id: 53, name: "Doo-Dah" },
    { id: 54, name: "Doo-Doh" },
    { id: 55, name: "Doo-Doo" },
    { id: 56, name: "Doo-Kah" },
    { id: 57, name: "Doo-Koh" },
    { id: 58, name: "Doo-Tah" },
    { id: 59, name: "Doo-Toh" },
    { id: 60, name: "Kee-Bay" },
    { id: 61, name: "Kee-Boh" },
    { id: 62, name: "Kee-Boo" },
    { id: 63, name: "Kee-Dah" },
    { id: 64, name: "Kee-Doh" },
    { id: 65, name: "Kee-Doo" },
    { id: 66, name: "Kee-Kah" },
    { id: 67, name: "Kee-Koh" },
    { id: 68, name: "Kee-Tah" },
    { id: 69, name: "Kee-Toh" },
    { id: 70, name: "Loo-Bay" },
    { id: 71, name: "Loo-Boh" },
    { id: 72, name: "Loo-Boo" },
    { id: 73, name: "Loo-Dah" },
    { id: 74, name: "Loo-Doh" },
    { id: 75, name: "Loo-Doo" },
    { id: 76, name: "Loo-Kah" },
    { id: 77, name: "Loo-Koh" },
    { id: 78, name: "Loo-Tah" },
    { id: 79, name: "Loo-Toh" },
    { id: 80, name: "May-Bay" },
    { id: 81, name: "May-Boh" },
    { id: 82, name: "May-Boo" },
    { id: 83, name: "May-Dah" },
    { id: 84, name: "May-Doh" },
    { id: 85, name: "May-Doo" },
    { id: 86, name: "May-Kah" },
    { id: 87, name: "May-Koh" },
    { id: 88, name: "May-Tah" },
    { id: 89, name: "May-Toh" },
    { id: 90, name: "Noo-Bay" },
    { id: 91, name: "Noo-Boh" },
    { id: 92, name: "Noo-Boo" },
    { id: 93, name: "Noo-Dah" },
    { id: 94, name: "Noo-Doh" },
    { id: 95, name: "Noo-Doo" },
    { id: 96, name: "Noo-Kah" },
    { id: 97, name: "Noo-Koh" },
    { id: 98, name: "Noo-Tah" },
    { id: 99, name: "Noo-Toh" },
    { id: 100, name: "Tay-Bay" },
    { id: 101, name: "Tay-Boh" },
    { id: 102, name: "Tay-Boo" },
    { id: 103, name: "Tay-Dah" },
    { id: 104, name: "Tay-Doh" },
    { id: 105, name: "Tay-Doo" },
    { id: 106, name: "Tay-Kah" },
    { id: 107, name: "Tay-Koh" },
    { id: 108, name: "Tay-Toh" },
    { id: 109, name: "Toh-Bay" },
    { id: 110, name: "Toh-Boh" },
    { id: 111, name: "Toh-Boo" },
    { id: 112, name: "Toh-Dah" },
    { id: 113, name: "Toh-Doh" },
    { id: 114, name: "Toh-Doo" },
    { id: 115, name: "Toh-Kah" },
    { id: 116, name: "Toh-Koh" },
    { id: 117, name: "Toh-Tah" },
    { id: 118, name: "Toh-Toh" },
    { id: 119, name: "Way-Bay" },
    { id: 120, name: "Way-Boh" },
    { id: 121, name: "Way-Boo" },
    { id: 122, name: "Way-Dah" },
    { id: 123, name: "Way-Doh" },
    { id: 124, name: "Way-Doo" },
    { id: 125, name: "Way-Kah" },
    { id: 126, name: "Way-Koh" },
    { id: 127, name: "Way-Tah" },
    { id: 128, name: "Way-Toh" }
];

// Name helper initialization
function initNameHelper() {
    const nameSearch = document.getElementById('name-search');
    const nameDropdown = document.getElementById('name-dropdown');
    const nameList = document.getElementById('name-list');
    const nameIdInput = document.getElementById('name-id');
    const selectedNameDisplay = document.getElementById('selected-name-display');
    const setNameBtn = document.getElementById('btn-set-name');
    
    // Show dropdown on focus
    nameSearch.addEventListener('focus', () => {
        updateNameDropdown('');
        nameDropdown.classList.remove('hidden');
    });
    
    // Hide dropdown on click outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.name-helper')) {
            nameDropdown.classList.add('hidden');
        }
    });
    
    // Search as you type
    nameSearch.addEventListener('input', (e) => {
        updateNameDropdown(e.target.value);
    });
    
    function updateNameDropdown(searchTerm) {
        const term = searchTerm.toLowerCase();
        
        // Filter names
        const filtered = FURBY_NAMES.filter(name => {
            if (!term) return true;
            
            // Search in name or ID
            const nameMatch = name.name.toLowerCase().includes(term);
            const idMatch = name.id.toString().includes(term);
            
            return nameMatch || idMatch;
        });
        
        nameList.innerHTML = '';
        filtered.slice(0, 50).forEach(name => {
            nameList.appendChild(createNameItem(name, term));
        });
        
        if (filtered.length === 0) {
            nameList.innerHTML = '<div class="action-item">No names found</div>';
        }
    }
    
    function createNameItem(name, highlightTerm = '') {
        const item = document.createElement('div');
        item.className = 'action-item';
        
        const title = document.createElement('div');
        title.className = 'action-item-title';
        
        // Highlight search term
        if (highlightTerm && name.name.toLowerCase().includes(highlightTerm.toLowerCase())) {
            const regex = new RegExp(`(${highlightTerm})`, 'gi');
            title.innerHTML = name.name.replace(regex, '<strong>$1</strong>');
        } else {
            title.textContent = name.name;
        }
        
        const id = document.createElement('div');
        id.className = 'action-item-coords';
        id.textContent = `ID: ${name.id}`;
        
        item.appendChild(title);
        item.appendChild(id);
        
        item.addEventListener('click', () => {
            nameIdInput.value = name.id;
            selectedNameDisplay.textContent = name.name;
            nameSearch.value = '';
            nameDropdown.classList.add('hidden');
        });
        
        return item;
    }
    
    // Set name button
    setNameBtn.addEventListener('click', async () => {
        const nameId = parseInt(nameIdInput.value);
        const furbyName = FURBY_NAMES.find(n => n.id === nameId);
        
        if (!furbyName) {
            log('Invalid name ID', 'error');
            return;
        }
        
        try {
            const result = await apiCall(`/name/${nameId}`, 'POST');
            log(`Name set to ${furbyName.name}!`, 'success');
        } catch (error) {
            log(`Failed to set name: ${error.message}`, 'error');
        }
    });
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initNameHelper);
} else {
    initNameHelper();
}
